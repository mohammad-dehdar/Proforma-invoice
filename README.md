# Proforma Invoice Manager

سیستم مدیریت پیش‌فاکتور مبتنی بر Next.js که اکنون شامل بک‌اند کامل برای مدیریت کاربران، احراز هویت و ذخیره‌سازی اطلاعات در MongoDB است. این برنامه به شما اجازه می‌دهد فاکتورها را ایجاد، ویرایش و حذف کنید و داشبورد و تاریخچه را به صورت زنده از پایگاه داده دریافت نمایید.

## پیش‌نیازها

- Node.js نسخه 18 یا بالاتر
- دسترسی به یک پایگاه داده MongoDB (سازگار با MongoDB Atlas)

## راه‌اندازی

1. وابستگی‌ها را نصب کنید:

```bash
npm install
```

2. متغیرهای محیطی را در یک فایل `.env.local` تنظیم کنید:

```bash
MONGODB_URI=mongodb+srv://<username>:<password>@<cluster-url>/?appName=Cluster0
MONGODB_DB=proforma-invoice   # اختیاری، مقدار پیش‌فرض همین است
JWT_SECRET=یک_رشته_قوی_برای_امضا
```

> **نکته:** از یک رشته تصادفی و طولانی برای `JWT_SECRET` استفاده کنید.

3. ایجاد کاربر اولیه:

```bash
npm run seed-user -- <username> <password>
```

این دستور اگر کاربری با نام کاربری مشخص وجود نداشته باشد، او را ایجاد می‌کند و در غیر این صورت رمز عبور او را به‌روزرسانی خواهد کرد. می‌توانید به جای ارسال آرگومان‌ها، متغیرهای `ADMIN_USERNAME` و `ADMIN_PASSWORD` را در محیط تنظیم کنید.

## اجرای پروژه

```bash
npm run dev
```

سپس برنامه را در آدرس [http://localhost:3000](http://localhost:3000) باز کنید. پس از ورود با حسابی که ساخته‌اید، می‌توانید فاکتورهای جدید ایجاد کنید، آن‌ها را در پایگاه داده ذخیره نمایید و از داشبورد و تاریخچه استفاده کنید.

## API

بک‌اند مجموعه‌ای از API‌های زیر را فراهم می‌کند (تمامی آن‌ها نیاز به احراز هویت دارند مگر آن‌که خلافش ذکر شده باشد):

- `POST /api/auth/login` – ورود و دریافت کوکی نشست
- `POST /api/auth/logout` – خروج و پاک‌سازی نشست
- `GET /api/auth/session` – بررسی وضعیت نشست کاربر
- `GET /api/invoices` – دریافت فاکتورها
- `POST /api/invoices` – ایجاد فاکتور جدید
- `PUT /api/invoices/:id` – بروزرسانی فاکتور
- `DELETE /api/invoices/:id` – حذف فاکتور
- `GET /api/dashboard` – دریافت آمار داشبورد و آخرین فاکتورها

## نکات امنیتی

- کوکی نشست به صورت HTTP-Only و با امضای HMAC ذخیره می‌شود.
- رمزهای عبور با استفاده از الگوریتم Scrypt همراه با Salt تصادفی در پایگاه داده ذخیره می‌شوند.

## تست و کد

- `npm run lint` برای بررسی قواعد کدنویسی
- `npm test` برای اجرای تست‌ها (در صورت وجود)

لطفاً پیش از ارسال به محیط تولید، حتماً پیکربندی‌های امنیتی و مقادیر محیطی را بررسی کنید.
